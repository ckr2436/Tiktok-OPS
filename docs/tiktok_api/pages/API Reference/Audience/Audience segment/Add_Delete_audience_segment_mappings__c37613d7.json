{
  "title": "Add/Delete audience segment mappings",
  "endpoint": "https://business-api.tiktok.com/open_api/v1.3/segment/mapping/",
  "method": "POST",
  "category_path": [
    "Audience",
    "Audience segment"
  ],
  "official_only": true,
  "request": {
    "headers": [
      {
        "name": "Access-Token",
        "required": true,
        "type": "string",
        "raw_type": "string",
        "description": "Authorized access token. For details, see Authentication ."
      },
      {
        "name": "Content-Type",
        "required": true,
        "type": "string",
        "raw_type": "string",
        "description": "Request message type. Allowed format: application/json ."
      }
    ],
    "parameters": [
      {
        "name": "advertiser_ids",
        "required": true,
        "type": "array",
        "raw_type": "string[]",
        "description": "A list of advertiser IDs to make segment mappings, or delete existing segment mappings. All advertiser IDs must belong to the same business account."
      },
      {
        "name": "action",
        "required": false,
        "type": "string",
        "raw_type": "string",
        "description": "Type of action to be performed. Enum values: add : To add UIDs to an audience or a group of audiences. delete : To remove UIDs from an audience or a group of audiences. Default value: add . Note : UID refers to hashed Device ID ( id_type = IDFA_MD5 , AAID_MD5 , IDFA_SHA256 , or AAID_SHA256 ). External user ID such as hashed email or hashed phone ( id_type = EMAIL_SHA256 , PHONE_SHA256 )"
      },
      {
        "name": "id_schema",
        "required": true,
        "type": "array",
        "raw_type": "string[]",
        "description": "ID Types to be used for populating the audiences. Allowed values: IDFA_MD5 : MD5 hash of an iOS IDFA. AAID_MD5 : MD5 hash of an Android AAID/GAID. IDFA_SHA256 : SHA256 iOS IDFA. AAID_SHA256 : SHA256 Android AAID/GAID. EMAIL_SHA256 : SHA256 hash of email ID. Please refer to Important Notes for Streaming API- Email Specific Normalization section. PHONE_SHA256 : SHA256 hash of a phone number in E.164 form, e.g. +1231234567. Note : Duplicate ID Types are not allowed. The ID Types can be provided in any order, and you can pass in the allowed values in lower case."
      },
      {
        "name": "batch_data",
        "required": true,
        "type": "array",
        "raw_type": "object[]",
        "description": "batch_data contains one or more of the following items as an array in JSON format. The object is used to add or delete multiple ID mapping (multiple audience IDs per user or device )."
      },
      {
        "name": "id",
        "required": false,
        "type": "string",
        "raw_type": "string",
        "description": "ID of a user or device."
      },
      {
        "name": "audience_ids",
        "required": false,
        "type": "array",
        "raw_type": "string[]",
        "description": "Array of audience_id to add or delete multiple ID mapping. Audience IDs must belong to at least one of the advertisers provided in the advertiser_ids field. Note : You can get audience_id via /segment/audience/ ."
      }
    ],
    "examples": [
      {
        "title": "Example",
        "curl": "curl --location --request POST 'https://business-api.tiktok.com/open_api/v1.3/segment/mapping/' \\\n--header 'Access-Token: <put_your_access_token_here>' \\\n--header 'Content-Type: application/json' \\\n--data '{\n    \"advertiser_ids\": \n        [\"{{advertiser_id}}\", \"{{advertiser_id}}\"], // advertisers must belong to the same business account\n    \"action\":\"add\",\n    \"id_schema\": [\n      \"IDFA_SHA256\"\n    ],\n    \"batch_data\": [\n        [\n            {\n            \"id\": \"{{id1}}\",\n            \"audience_ids\": [\"17181920\"] // audiences must belong to at least one of the advertisers provided in the advertiser_ids field\n            },\n            {\n            \"id\": \"{{id2}}\",\n            \"audience_ids\": [\"17181920\"]\n            }\n        ],\n        [\n            {\n            \"id\": \"{{id3}}\",\n            \"audience_ids\": [\"123456\",\"7891011\",\"13141516\"]\n            },\n            {\n            \"id\": \"{{id4}}\",\n            \"audience_ids\": [\"17181920\",\"2122232425\",\"262728293\"]\n            }\n        ],\n        [\n            {}, //empty because this user does not have an IDFA \n            {\n            \"id\": \"{{id5}}\",\n            \"audience_ids\": [\"17181920\",\"2122232425\",\"262728293\"]\n            }\n        ]\n    ]\n}'"
      }
    ]
  },
  "response": {
    "top_fields": [
      {
        "name": "code",
        "required": false,
        "type": "number",
        "raw_type": "number",
        "description": "Return code. For the complete list of response codes and descriptions, see Appendix-Return Codes ."
      },
      {
        "name": "message",
        "required": false,
        "type": "string",
        "raw_type": "string",
        "description": "Return message. For details, see Appendix-Return message ."
      },
      {
        "name": "data",
        "required": false,
        "type": "object",
        "raw_type": "object",
        "description": "Returned data."
      }
    ],
    "data": {
      "fields": [
        {
          "name": "request_id",
          "required": false,
          "type": "string",
          "raw_type": "string",
          "description": "The log id of a request, which uniquely identifies the request."
        }
      ],
      "list": {
        "item_fields": []
      }
    },
    "other_tables": [],
    "example": {
      "status_line": "",
      "body": {
        "code": 200,
        "message": "OK",
        "request_id": "XXXXXXXXXX",
        "data": {}
      }
    }
  }
}
